(()=>{"use strict";function t(t){return function(t,e,i="A",a){const s="A"===i?a.offsetAX:a.offsetBX,n="A"===i?a.offsetAY:a.offsetBY;return{x:t*a.scale+a.offsetX+s,y:e*a.scale+a.offsetY+n}}(t.wipePositionInImageACoords.x,t.wipePositionInImageACoords.y,"A",t)}const e=70,i=20;function a(t,e){const i=e*(Math.PI/180);return{x:t.x+60*Math.cos(i),y:t.y+60*Math.sin(i)}}function s(t,e,a){const s=e*(Math.PI/180)-(i+50*(1-a))*Math.PI/180;return{x:t.x+40*Math.cos(s),y:t.y+40*Math.sin(s)}}const n=new WeakMap;function o(t,e,i,a=0,s=0,o=10){const h=`${o}`;let r=n.get(t);r||(r=new Map,n.set(t,r));let l=r.get(h);if(!l){const e=function(t,e=10,i="black",a="#808080"){const s=document.createElement("canvas");s.width=2*e,s.height=2*e;const n=s.getContext("2d");return n?(n.fillStyle=i,n.fillRect(0,0,2*e,2*e),n.fillStyle=a,n.fillRect(0,0,e,e),n.fillRect(e,e,e,e),t.createPattern(s,"repeat")):null}(t,o);if(!e)return;l=e,r.set(h,l)}t.save(),t.fillStyle=l;const d=2*o;0===a&&0===s||t.translate(-a%d,-s%d),t.fillRect(0,0,e+d,i+d),t.restore()}function h(t,e,i,a,s,n){if(!n.imageB)return;const o=n.imageB.width*n.scale,h=n.imageB.height*n.scale,l=n.offsetX+n.offsetBX,d=n.offsetY+n.offsetBY,c=[{x:l,y:d},{x:l+o,y:d},{x:l+o,y:d+h},{x:l,y:d+h}],g=Math.cos(i),p=Math.sin(i),f=c.map(t=>{const i=t.x-e.x,a=t.y-e.y,s=i*g+a*p;return{corner:t,onCompositeSide:s>0,distance:s}}).filter(t=>t.onCompositeSide).map(t=>t.corner);if(0===f.length)return t.beginPath(),void t.rect(0,0,0,0);if(4===f.length)return t.beginPath(),t.moveTo(c[0].x,c[0].y),t.lineTo(c[1].x,c[1].y),t.lineTo(c[2].x,c[2].y),t.lineTo(c[3].x,c[3].y),void t.closePath();const m=[],u=-Math.sin(i),b=Math.cos(i),w=[{start:c[0],end:c[1]},{start:c[1],end:c[2]},{start:c[2],end:c[3]},{start:c[3],end:c[0]}];for(const t of w){const i=r(e.x,e.y,e.x+u,e.y+b,t.start.x,t.start.y,t.end.x,t.end.y);i&&i.x>=Math.min(t.start.x,t.end.x)-1e-6&&i.x<=Math.max(t.start.x,t.end.x)+1e-6&&i.y>=Math.min(t.start.y,t.end.y)-1e-6&&i.y<=Math.max(t.start.y,t.end.y)+1e-6&&m.push(i)}const A=[];for(const t of m)A.some(e=>Math.abs(e.x-t.x)<1e-6&&Math.abs(e.y-t.y)<1e-6)||A.push(t);if(t.beginPath(),A.length>=2){const e=[];for(const t of f)e.push({...t,type:"corner"});for(const t of A)e.push({...t,type:"intersection"});const i=[];if(f.length>0){i.push(...f),i.push(...A);const t=i.reduce((t,e)=>t+e.x,0)/i.length,e=i.reduce((t,e)=>t+e.y,0)/i.length;i.sort((i,a)=>Math.atan2(i.y-e,i.x-t)-Math.atan2(a.y-e,a.x-t))}if(i.length>0){t.moveTo(i[0].x,i[0].y);for(let e=1;e<i.length;e++)t.lineTo(i[e].x,i[e].y);t.closePath()}}else if(f.length>0){t.moveTo(f[0].x,f[0].y);for(let e=1;e<f.length;e++)t.lineTo(f[e].x,f[e].y);t.closePath()}}function r(t,e,i,a,s,n,o,h){const r=(t-i)*(n-h)-(e-a)*(s-o);if(Math.abs(r)<1e-10)return null;const l=((t-s)*(n-h)-(e-n)*(s-o))/r;return{x:t+l*(i-t),y:e+l*(a-e)}}function l(t,e){if(t.ctx)switch(t.compositeMode){case"Under":d(t,"A"),t.ctx.globalAlpha=e,d(t,"B"),t.ctx.globalAlpha=1;break;case"OnionSkin":{d(t,"A"),t.ctx.globalAlpha=e;const i=t.ctx.globalCompositeOperation;t.ctx.globalCompositeOperation="lighter",d(t,"B"),t.ctx.globalCompositeOperation=i,t.ctx.globalAlpha=1;break}case"A":d(t,"A");break;case"B":d(t,"B");break;case"Diff":case"InvDiff":g(t,"InvDiff"===t.compositeMode,e)}}function d(t,e){if(!t.ctx)return;const i="A"===e?t.imageA:t.imageB,a="A"===e?t.imageAMipMaps:t.imageBMipMaps,s="A"===e?t.offsetAX:t.offsetBX,n="A"===e?t.offsetAY:t.offsetBY;if(!i)return;const o=t.offsetX+s,h=t.offsetY+n,r=i.width*t.scale,l=i.height*t.scale;a&&a.length>0?function(t,e,i,a,s,n,o,h){let r=0,l=h;for(;l<.5&&r<i.length-1;)l*=2,r++;const d=0===r?e:i[r-1];t.imageSmoothingEnabled=h<1,t.drawImage(d,0,0,d.width,d.height,a,s,n,o)}(t.ctx,i,a,o,h,r,l,t.scale):(t.ctx.imageSmoothingEnabled=t.scale<1,t.ctx.drawImage(i,0,0,i.width,i.height,o,h,r,l))}function c(t,e,i){t.save(),t.strokeStyle="white",t.lineWidth=1,t.shadowColor="black",t.shadowBlur=2;const a=t.canvas.width/2,s=t.canvas.height/2,n=i*(Math.PI/180),o=-Math.sin(n),h=Math.cos(n),r=(a-e.x)*o+(s-e.y)*h,l=e.x+r*o,d=e.y+r*h,c=2*Math.max(t.canvas.width,t.canvas.height),g=l-o*c,p=d-h*c,f=l+o*c,m=d+h*c;t.beginPath(),t.moveTo(g,p),t.lineTo(f,m),t.stroke(),t.restore()}function g(t,e,i=1){if(!t.ctx||!t.imageA||!t.imageB)return;const a=document.createElement("canvas");a.width=t.canvas.width,a.height=t.canvas.height;const s=a.getContext("2d");s&&(e&&(s.fillStyle="white",s.fillRect(0,0,a.width,a.height)),d({...t,ctx:s,canvas:a},"B"),s.globalCompositeOperation="difference",d({...t,ctx:s,canvas:a},"A"),e&&(s.globalCompositeOperation="difference",s.fillStyle="white",s.fillRect(0,0,a.width,a.height)),t.ctx.globalAlpha=i,t.ctx.drawImage(a,0,0),t.ctx.globalAlpha=1)}class p extends HTMLElement{constructor(){super(),this.state={canvas:null,ctx:null,imageA:null,imageB:null,imageAData:null,imageBData:null,imageAMipMaps:null,imageBMipMaps:null,imageALoaded:!1,imageBLoaded:!1,scale:1,offsetX:0,offsetY:0,offsetAX:0,offsetAY:0,offsetBX:0,offsetBY:0,isWipeEnabled:!0,isSimpleWipe:!1,wipeAngle:0,wipePositionInImageACoords:{x:0,y:0},wipeAlpha:1,isCheckerboard:!1,compositeMode:"Under",showHelp:!0,magnifierRadius:200,magnifierZoomFactor:8,magnifierBorderSize:2,checkerboardSquareSize:10},this.previousWipeAngle=0,this.previousWipeAlpha=1,this.lastCompositeMode="Under",this.isDragging=!1,this.dragStartX=0,this.dragStartY=0,this.lastMouseX=0,this.lastMouseY=0,this.showMagnifier=!1,this.activeHandle=null,this.manuallyToggledHelp=!1,this.dragSide=null,this.accumulatedDX=0,this.accumulatedDY=0,this.shadow=this.attachShadow({mode:"open"}),this.createComponentStructure(),this.initialize()}static get observedAttributes(){return["image-a","image-b","display-mode","wipe-mode","wipe-position-x","wipe-position-y","wipe-angle","wipe-alpha","magnifier-radius","magnifier-zoom-factor","magnifier-border-size","checkerboard-square-size"]}connectedCallback(){this.processAttributes(),this.updateCanvasSize(),new ResizeObserver(()=>{this.updateCanvasSize()}).observe(this),this.updateHelpScreenVisibility()}getImageElements(t){const e="A"===t;return{isLoaded:e?this.state.imageALoaded:this.state.imageBLoaded,image:e?this.state.imageA:this.state.imageB,imageData:e?this.state.imageAData:this.state.imageBData,coordsRgbaElement:e?this.coordsRgbaA:this.coordsRgbaB,filenameElement:e?this.filenameA:this.filenameB,uploadElement:e?this.uploadA:this.uploadB,fileInputElement:e?this.fileInputA:this.fileInputB}}setNumericAttribute(t,e){if(!e)return;const i=parseFloat(e);if(!isNaN(i))switch(t){case"wipe-position-x":this.setWipePositionX(i);break;case"wipe-position-y":this.setWipePositionY(i);break;case"wipe-angle":this.setWipeAngle(i);break;case"wipe-alpha":this.setWipeAlpha(i);break;case"magnifier-radius":this.setMagnifierRadius(i);break;case"magnifier-zoom-factor":this.setMagnifierZoomFactor(i);break;case"magnifier-border-size":this.setMagnifierBorderSize(i);break;case"checkerboard-square-size":this.setCheckerboardSquareSize(i)}}attributeChangedCallback(t,e,i){if(e!==i)switch(t){case"image-a":i&&this.loadImage(i,"A");break;case"image-b":i&&this.loadImage(i,"B");break;case"display-mode":i&&this.setDisplayMode(i);break;case"wipe-mode":this.setWipeMode("simple"===i);break;case"wipe-position-x":case"wipe-position-y":case"wipe-angle":case"wipe-alpha":case"magnifier-radius":case"magnifier-zoom-factor":case"magnifier-border-size":case"checkerboard-square-size":this.setNumericAttribute(t,i)}}createComponentStructure(){const t=document.createElement("style");t.textContent=this.getComponentStyles(),this.shadow.appendChild(t);const e=document.createElement("div");e.className="image-comparison-container",e.innerHTML='\n            <div id="canvas-container">\n                <canvas id="imageCanvas"></canvas>\n                <div id="magnifier-container" class="hidden">\n                    <canvas id="magnifierCanvas"></canvas>\n                </div>\n                <div id="drag-message"></div>\n                <div id="help-screen">\n                    <h1>Image Comparison Element</h1>\n                    <p>Upload images by clicking on the A or B boxes in the bottom banner</p>\n                    <p>or drag and drop image files anywhere in the application:</p>\n                    <ul>\n                        <li>Drag and drop a single image anywhere (except B box): loads as image A</li>\n                        <li>Drag and drop multiple images anywhere: loads first as A, second as B</li>\n                        <li>Drag and drop directly onto A or B boxes: loads to that specific slot</li>\n                    </ul>\n                    <p>Use mouse wheel to zoom, click and drag to move both images.</p>\n                    <p>Use Shift+click and drag to move only one image (A or B).</p>\n                    <p>Press "v" for simple wipe, "w" for full wipe interface.</p>\n                    <p>Press "u", "o", "d", "i" to change composite modes.</p>\n                    <p>Press "a" to show only image A, "b" to show only image B.</p>\n                    <p>Press "c" to toggle checkerboard background.</p>\n                    <p>Press "r" to reset view (position, zoom, wipe settings).</p>\n                    <p>Press "h" or "?" to toggle this help screen.</p>\n                    <p id="magnifier-help">Hold Ctrl to show magnifying glass at mouse pointer position.</p>\n                </div>\n            </div>\n            <div id="bottom-banner">\n                <div class="banner-section">\n                    <div id="upload-container">\n                        <div id="upload-a" class="upload-box">\n                            <span>A: </span>\n                            <span id="filename-a">No file</span>\n                            <span id="coords-rgba-a"></span>\n                            <input type="file" id="file-a" accept="image/*" style="display:none">\n                        </div>\n                        <div id="upload-b" class="upload-box">\n                            <span>B: </span>\n                            <span id="filename-b">No file</span>\n                            <span id="coords-rgba-b"></span>\n                            <input type="file" id="file-b" accept="image/*" style="display:none">\n                        </div>\n                    </div>\n                </div>\n                <div class="banner-section">\n                    <div id="psnr-info">PSNR: -</div>\n                </div>\n                <div class="banner-section">\n                    <div id="mode-container">\n                        <span>Mode: </span>\n                        <span id="mode-info">Under</span>\n                    </div>\n                </div>\n                <div class="banner-section">\n                    <div id="help-info">Help: press "h"</div>\n                </div>\n            </div>\n        ',this.shadow.appendChild(e)}getComponentStyles(){return"\n            :host {\n                display: block;\n                width: 100%;\n                height: 100%;\n                min-height: 400px;\n                font-family: Arial, sans-serif;\n                color: #fff;\n                background-color: #333;\n                position: relative;\n                overflow: hidden;\n            }\n            \n            .image-comparison-container {\n                width: 100%;\n                height: 100%;\n                display: flex;\n                flex-direction: column;\n                position: relative;\n            }\n            \n            #canvas-container {\n                flex: 1;\n                position: relative;\n                overflow: hidden;\n            }\n            \n            #imageCanvas {\n                width: 100%;\n                height: 100%;\n                display: block;\n                background-color: black;\n                cursor: move;\n            }\n            \n            #magnifier-container {\n                position: absolute;\n                width: var(--magnifier-diameter, 400px);\n                height: var(--magnifier-diameter, 400px);\n                border-radius: 50%;\n                overflow: hidden;\n                pointer-events: none;\n                box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);\n                border: 2px solid white;\n                cursor: none;\n                will-change: transform;\n                transform: translateZ(0);\n                backface-visibility: hidden;\n                z-index: 1000;\n                background-color: black;\n            }\n            \n            #magnifierCanvas {\n                width: 100%;\n                height: 100%;\n                display: block;\n            }\n            \n            .hidden {\n                display: none;\n            }\n            \n            #drag-message {\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                background-color: rgba(0, 0, 0, 0.7);\n                color: white;\n                padding: 15px 25px;\n                border-radius: 8px;\n                font-size: 18px;\n                z-index: 1000;\n                pointer-events: none;\n                box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);\n                border: 1px solid rgba(255, 255, 255, 0.3);\n                max-width: 80%;\n                text-align: center;\n                opacity: 0;\n                transition: opacity 0.3s;\n            }\n            \n            #help-screen {\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                bottom: 40px;\n                background-color: rgba(0, 0, 0, 0.6);\n                color: white;\n                display: flex;\n                flex-direction: column;\n                justify-content: center;\n                align-items: center;\n                z-index: 100;\n                text-align: center;\n                padding: 15px;\n                box-sizing: border-box;\n                overflow-y: auto;\n            }\n            \n            #help-screen h1 {\n                font-size: 18px;\n                margin-bottom: 15px;\n                margin-top: 0;\n            }\n            \n            #help-screen p {\n                font-size: 12px;\n                margin: 3px 0;\n                max-width: 90%;\n                line-height: 1.3;\n            }\n            \n            #help-screen ul {\n                text-align: left;\n                max-width: 90%;\n                font-size: 12px;\n                margin: 8px 0;\n                padding-left: 20px;\n                line-height: 1.3;\n            }\n            \n            #help-screen li {\n                margin: 2px 0;\n            }\n            \n            #magnifier-help {\n                font-size: 12px;\n                margin: 8px 0 3px 0;\n                max-width: 90%;\n                line-height: 1.3;\n            }\n            \n            #bottom-banner {\n                height: 40px;\n                background-color: #222;\n                display: flex;\n                align-items: center;\n                padding: 0 10px;\n                box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.3);\n                font-size: 12px;\n            }\n            \n            .banner-section {\n                margin-right: 10px;\n                display: flex;\n                align-items: center;\n            }\n            \n            #upload-container {\n                display: flex;\n            }\n            \n            .upload-box {\n                background-color: #555;\n                padding: 5px 10px;\n                margin-right: 10px;\n                border-radius: 3px;\n                cursor: pointer;\n                transition: background-color 0.2s;\n                white-space: nowrap;\n                font-size: 12px;\n                min-width: 150px;\n                flex-shrink: 0;\n            }\n            \n            .upload-box:hover {\n                background-color: #777;\n            }\n            \n            .info-section {\n                font-size: 12px;\n                color: #fff;\n            }\n            \n            #image-a-info, #image-b-info {\n                margin-right: 5px;\n            }\n        "}initialize(){this.initDomReferences(),this.initCanvas(),this.setupEventListeners()}initDomReferences(){this.state.canvas=this.shadow.getElementById("imageCanvas"),this.magnifierContainer=this.shadow.getElementById("magnifier-container"),this.magnifierCanvas=this.shadow.getElementById("magnifierCanvas"),this.dragMessage=this.shadow.getElementById("drag-message"),this.uploadA=this.shadow.getElementById("upload-a"),this.uploadB=this.shadow.getElementById("upload-b"),this.fileInputA=this.shadow.getElementById("file-a"),this.fileInputB=this.shadow.getElementById("file-b"),this.filenameA=this.shadow.getElementById("filename-a"),this.filenameB=this.shadow.getElementById("filename-b"),this.coordsRgbaA=this.shadow.getElementById("coords-rgba-a"),this.coordsRgbaB=this.shadow.getElementById("coords-rgba-b"),this.psnrInfo=this.shadow.getElementById("psnr-info"),this.modeInfo=this.shadow.getElementById("mode-info"),this.helpScreen=this.shadow.getElementById("help-screen"),this.magnifierHelp=this.shadow.getElementById("magnifier-help")}initCanvas(){this.state.canvas?(this.state.ctx=this.state.canvas.getContext("2d",{alpha:!1}),this.state.ctx||console.error("Failed to get canvas context")):console.error("Canvas element not found")}processAttributes(){const t=this.getAttribute("image-a"),e=this.getAttribute("image-b");t&&this.loadImage(t,"A"),e&&this.loadImage(e,"B");const i=this.getAttribute("display-mode");i&&this.setDisplayMode(i);const a=this.getAttribute("wipe-mode");a&&this.setWipeMode("simple"===a);const s=this.getAttribute("wipe-position-x"),n=this.getAttribute("wipe-position-y");s&&this.setWipePositionX(parseFloat(s)),n&&this.setWipePositionY(parseFloat(n));const o=this.getAttribute("wipe-angle");o&&this.setWipeAngle(parseFloat(o));const h=this.getAttribute("wipe-alpha");h&&this.setWipeAlpha(parseFloat(h));const r=this.getAttribute("magnifier-radius");r&&this.setMagnifierRadius(parseFloat(r));const l=this.getAttribute("magnifier-zoom-factor");l&&this.setMagnifierZoomFactor(parseFloat(l));const d=this.getAttribute("magnifier-border-size");d&&this.setMagnifierBorderSize(parseFloat(d));const c=this.getAttribute("checkerboard-square-size");c&&this.setCheckerboardSquareSize(parseFloat(c))}updateCanvasSize(){if(!this.state.canvas)return;const t=this.clientWidth,e=this.clientHeight-40;t>0&&e>0&&(this.state.canvas.width=t,this.state.canvas.height=e,this.magnifierCanvas&&(this.magnifierCanvas.width=400,this.magnifierCanvas.height=400),this.draw())}updateHelpScreenVisibility(){(this.state.imageALoaded?1:0)+(this.state.imageBLoaded?1:0)>=1?this.state.showHelp&&!this.manuallyToggledHelp?(this.state.showHelp=!1,this.helpScreen.style.display="none"):this.state.showHelp?this.helpScreen.style.display="flex":this.helpScreen.style.display="none":(this.helpScreen.style.display="flex",this.manuallyToggledHelp=!1),this.updateMagnifierHelpVisibility()}updateMagnifierHelpVisibility(){this.magnifierHelp&&(this.state.magnifierZoomFactor&&this.state.magnifierZoomFactor>0?(this.magnifierHelp.style.display="block",this.magnifierHelp.textContent=`Hold Ctrl to show magnifying glass (${this.state.magnifierZoomFactor}x zoom) at mouse pointer position.`):this.magnifierHelp.style.display="none")}async loadImage(t,e,i){this.dragMessage.textContent="Loading image...",this.dragMessage.style.opacity="1",console.log(`Loading image ${e} from URL:`,t);const a=new Image;return new Promise((s,n)=>{a.onload=async()=>{try{"A"===e?(this.state.imageA=a,this.state.imageALoaded=!0):(this.state.imageB=a,this.state.imageBLoaded=!0);const n=document.createElement("canvas");n.width=a.width,n.height=a.height;const h=n.getContext("2d");h&&(h.drawImage(a,0,0),"A"===e?this.state.imageAData=h.getImageData(0,0,a.width,a.height):this.state.imageBData=h.getImageData(0,0,a.width,a.height));const r=await(o=a,new Promise(t=>{const e=[o];let i=o.width,a=o.height;if(i<4||a<4)return void t(e);const s=()=>{if(i<=1&&a<=1)return void t(e);i=Math.max(1,Math.floor(i/2)),a=Math.max(1,Math.floor(a/2));const n=document.createElement("canvas");n.width=i,n.height=a;const o=n.getContext("2d");if(!o)return void t(e);o.imageSmoothingEnabled=!0,o.drawImage(e[e.length-1],0,0,i,a);const h=new Image;h.onload=()=>{e.push(h),s()},h.src=n.toDataURL()};s()}));"A"===e?this.state.imageAMipMaps=r:this.state.imageBMipMaps=r;const l=i||this.extractFilename(t);("A"===e?this.filenameA:this.filenameB).textContent=l,this.updateHelpScreenVisibility(),this.centerWipePosition(),this.fitImagesToViewport(),this.draw(),this.updatePSNR(),this.dragMessage.style.opacity="0",s()}catch(t){console.error(`Error processing image ${e}:`,t),n(t)}var o},a.onerror=i=>{this.dragMessage.style.opacity="0",console.error(`Error loading image ${e}:`,i),("A"===e?this.filenameA:this.filenameB).textContent="Error loading "+(t.split("/").pop()||t),n(i)},a.crossOrigin="anonymous",a.src=t})}setDisplayMode(t){const e=this.state.compositeMode;"A"!==t&&"B"!==t||"A"===this.state.compositeMode||"B"===this.state.compositeMode||(this.lastCompositeMode=this.state.compositeMode,this.state.isWipeEnabled&&(this.previousWipeAngle=this.state.wipeAngle,this.previousWipeAlpha=this.state.wipeAlpha)),this.state.compositeMode=t,this.modeInfo.textContent=t,"A"===t||"B"===t?this.state.isWipeEnabled=!1:(this.state.isWipeEnabled=!0,"A"!==e&&"B"!==e||(this.state.isSimpleWipe?this.state.wipeAngle=0:(this.state.wipeAngle=this.previousWipeAngle,this.state.wipeAlpha=this.previousWipeAlpha))),this.draw()}setWipeMode(t){t&&!this.state.isSimpleWipe&&(this.previousWipeAngle=this.state.wipeAngle,this.previousWipeAlpha=this.state.wipeAlpha),this.state.isWipeEnabled=!0,this.state.isSimpleWipe=t,t?this.state.wipeAngle=0:(this.state.wipeAngle=this.previousWipeAngle,this.state.wipeAlpha=this.previousWipeAlpha),"A"!==this.state.compositeMode&&"B"!==this.state.compositeMode||(this.state.compositeMode=this.lastCompositeMode,this.modeInfo.textContent=this.lastCompositeMode),this.draw()}setWipePositionX(t){this.state.wipePositionInImageACoords.x=t,this.draw()}setWipePositionY(t){this.state.wipePositionInImageACoords.y=t,this.draw()}setWipeAngle(t){this.state.wipeAngle=t,this.previousWipeAngle=t,this.draw()}setWipeAlpha(t){t=Math.max(0,Math.min(1,t)),this.state.wipeAlpha=t,this.previousWipeAlpha=t,this.draw()}setMagnifierRadius(t){t<=0||(this.state.magnifierRadius=t,this.style.setProperty("--magnifier-diameter",2*t+"px"),this.showMagnifier&&0!==this.lastMouseX&&0!==this.lastMouseY&&this.updateMagnifier(this.lastMouseX,this.lastMouseY))}setMagnifierZoomFactor(t){this.state.magnifierZoomFactor=t,this.updateMagnifierHelpVisibility(),t<=0&&this.showMagnifier?(this.showMagnifier=!1,this.magnifierContainer.classList.add("hidden")):t>0&&this.showMagnifier&&0!==this.lastMouseX&&0!==this.lastMouseY&&this.updateMagnifier(this.lastMouseX,this.lastMouseY)}setMagnifierBorderSize(t){t<0&&(console.warn("Magnifier border size must be non-negative, using default value of 2"),t=2),this.state.magnifierBorderSize=t,this.showMagnifier&&0!==this.lastMouseX&&0!==this.lastMouseY&&this.updateMagnifier(this.lastMouseX,this.lastMouseY)}setCheckerboardSquareSize(t){t<=0&&(console.warn("Checkerboard square size must be positive, using default value of 10"),t=10),this.state.checkerboardSquareSize=t,this.state.isCheckerboard&&this.draw()}centerWipePosition(){if(!this.state.canvas)return;const t=this.state.canvas.width/2,e=this.state.canvas.height/2,i=this.canvasToImageCoords(t,e,"A");this.state.wipePositionInImageACoords.x=i.x,this.state.wipePositionInImageACoords.y=i.y,this.setAttribute("wipe-position-x",i.x.toString()),this.setAttribute("wipe-position-y",i.y.toString()),this.draw()}fitImagesToViewport(){if(!this.state.canvas||!this.state.imageALoaded&&!this.state.imageBLoaded)return;const t=this.state.imageALoaded?this.state.imageA.width:this.state.imageBLoaded?this.state.imageB.width:0,e=this.state.imageALoaded?this.state.imageA.height:this.state.imageBLoaded?this.state.imageB.height:0;if(0===t||0===e)return;const i=this.state.canvas.width/t,a=this.state.canvas.height/e;this.state.scale=.9*Math.min(i,a),this.state.offsetX=(this.state.canvas.width-t*this.state.scale)/2,this.state.offsetY=(this.state.canvas.height-e*this.state.scale)/2}updatePSNR(){const t=function(t,e,i,a,s,n,o,h,r){if(!(t&&e&&i&&a))return"PSNR: N/A";const l=function(t,e,i,a,s,n,o,h,r){const l=i/r,d=a/r,c=l+t,g=d+e,p=o/r,f=h/r,m=p+s,u=f+n,b=Math.max(l,p),w=Math.max(d,f),A=Math.min(c,m),v=Math.min(g,u);return b>=A||w>=v?null:{width:A-b,height:v-w,aStartX:b-l,aStartY:w-d,bStartX:b-p,bStartY:w-f}}(i.width,i.height,s,n,a.width,a.height,o,h,r);if(!l||l.width<=0||l.height<=0)return"PSNR: No overlap";let d=0,c=0;for(let s=0;s<l.height;s++)for(let n=0;n<l.width;n++){const o=Math.floor(l.aStartX+n),h=Math.floor(l.aStartY+s),r=Math.floor(l.bStartX+n),g=Math.floor(l.bStartY+s);if(o>=0&&o<i.width&&h>=0&&h<i.height&&r>=0&&r<a.width&&g>=0&&g<a.height){const s=4*(h*i.width+o),n=4*(g*a.width+r),l=t.data[s]-e.data[n],p=t.data[s+1]-e.data[n+1],f=t.data[s+2]-e.data[n+2];d+=l*l+p*p+f*f,c++}}return 0===c?"PSNR: No valid pixels":(d/=3*c,0===d?"PSNR: ∞ (identical)":`PSNR: ${(20*Math.log10(255)-10*Math.log10(d)).toFixed(2)} dB`)}(this.state.imageAData,this.state.imageBData,this.state.imageA,this.state.imageB,this.state.offsetAX,this.state.offsetAY,this.state.offsetBX,this.state.offsetBY,this.state.scale);this.psnrInfo.textContent=t}setupCanvasEventListeners(){this.state.canvas&&(this.state.canvas.addEventListener("mousedown",this.handleMouseDown.bind(this)),this.state.canvas.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.state.canvas.addEventListener("mouseup",this.handleMouseUp.bind(this)),this.state.canvas.addEventListener("mouseleave",this.handleMouseUp.bind(this)),this.state.canvas.addEventListener("wheel",this.handleWheel.bind(this),{passive:!1}))}setupFileUploadListeners(){this.uploadA.addEventListener("click",()=>this.fileInputA.click()),this.uploadB.addEventListener("click",()=>this.fileInputB.click()),this.fileInputA.addEventListener("change",this.handleFileInputA.bind(this)),this.fileInputB.addEventListener("change",this.handleFileInputB.bind(this))}setupEventListeners(){this.state.canvas&&(this.setupFileUploadListeners(),this.setupCanvasEventListeners(),this.addEventListener("dragover",this.handleDragOver.bind(this)),this.addEventListener("drop",this.handleDrop.bind(this)),this.addEventListener("dragleave",this.handleDragLeave.bind(this)),this.uploadA.addEventListener("dragover",this.handleUploadBoxDragOver.bind(this,"A")),this.uploadA.addEventListener("dragleave",this.handleUploadBoxDragLeave.bind(this,"A")),this.uploadA.addEventListener("drop",this.handleUploadBoxDrop.bind(this,"A")),this.uploadB.addEventListener("dragover",this.handleUploadBoxDragOver.bind(this,"B")),this.uploadB.addEventListener("dragleave",this.handleUploadBoxDragLeave.bind(this,"B")),this.uploadB.addEventListener("drop",this.handleUploadBoxDrop.bind(this,"B")),this.addEventListener("keydown",this.handleKeyDown.bind(this)),this.addEventListener("keyup",this.handleKeyUp.bind(this)),this.tabIndex=0,this.addEventListener("mouseenter",()=>this.focus()))}handleMouseDown(e){e.preventDefault();const i=this.state.canvas.getBoundingClientRect(),n=e.clientX-i.left,o=e.clientY-i.top;if(this.accumulatedDX=0,this.accumulatedDY=0,this.state.isWipeEnabled&&this.state.imageALoaded&&this.state.imageBLoaded){const e=t(this.state);if(Math.sqrt(Math.pow(n-e.x,2)+Math.pow(o-e.y,2))<=6)return this.activeHandle="translation",this.dragStartX=n,this.dragStartY=o,void(this.state.canvas.style.cursor="grabbing");if(!this.state.isSimpleWipe){const{x:t,y:i}=a(e,this.state.wipeAngle);if(Math.sqrt(Math.pow(n-t,2)+Math.pow(o-i,2))<=4)return this.activeHandle="rotation",this.dragStartX=n,this.dragStartY=o,void(this.state.canvas.style.cursor="grabbing");const h=s(e,this.state.wipeAngle,this.state.wipeAlpha),r=h.x,l=h.y;if(Math.sqrt(Math.pow(n-r,2)+Math.pow(o-l,2))<=4)return this.activeHandle="alpha",this.dragStartX=n,this.dragStartY=o,void(this.state.canvas.style.cursor="grabbing")}}if(this.isDragging=!0,this.dragStartX=e.clientX,this.dragStartY=e.clientY,e.shiftKey&&this.state.isWipeEnabled&&this.state.imageALoaded&&this.state.imageBLoaded){const e=t(this.state),i=this.state.wipeAngle*(Math.PI/180),a=n-e.x,s=o-e.y,h=a*Math.cos(i)+s*Math.sin(i);this.dragSide=h<0?"A":"B",this.state.canvas.style.cursor="grabbing"}else this.state.canvas.style.cursor="move"}handleMouseMove(t){const e=this.state.canvas.getBoundingClientRect(),i=t.clientX-e.left,a=t.clientY-e.top;if(this.lastMouseX=i,this.lastMouseY=a,this.updateMouseInfo(i,a),this.activeHandle)this.handleWipeUIInteraction(i,a);else{if(this.isDragging){const e=t.clientX-this.dragStartX,i=t.clientY-this.dragStartY;if(t.shiftKey&&this.state.isWipeEnabled&&this.state.imageALoaded&&this.state.imageBLoaded&&this.dragSide){this.accumulatedDX+=e/this.state.scale,this.accumulatedDY+=i/this.state.scale;const t=Math.round(this.accumulatedDX),a=Math.round(this.accumulatedDY);0===t&&0===a||("A"===this.dragSide?(this.state.offsetAX+=t*this.state.scale,this.state.offsetAY+=a*this.state.scale):(this.state.offsetBX+=t*this.state.scale,this.state.offsetBY+=a*this.state.scale),this.accumulatedDX-=t,this.accumulatedDY-=a,this.draw(),this.updatePSNR())}else this.state.offsetX+=e,this.state.offsetY+=i,this.draw();this.dragStartX=t.clientX,this.dragStartY=t.clientY}else this.updateCursor(i,a,t.shiftKey);(t.ctrlKey||t.metaKey)&&this.state.magnifierZoomFactor&&this.state.magnifierZoomFactor>0?(this.showMagnifier=!0,this.updateMagnifier(i,a)):(this.showMagnifier=!1,this.magnifierContainer.classList.add("hidden"))}}handleMouseUp(t){this.isDragging=!1,this.activeHandle=null,this.dragSide=null,this.showMagnifier=!1,this.magnifierContainer.classList.add("hidden"),this.state.canvas&&(this.state.canvas.style.cursor="move")}handleWheel(t){if(t.preventDefault(),!this.state.imageALoaded&&!this.state.imageBLoaded)return;const e=this.state.canvas.getBoundingClientRect(),i=t.clientX-e.left,a=t.clientY-e.top,s=this.state.scale,n=Math.pow(1.00152,-t.deltaY);this.state.scale*=n;const o=this.state.scale/s;this.state.offsetX=i-o*(i-this.state.offsetX),this.state.offsetY=a-o*(a-this.state.offsetY),this.state.offsetAX*=o,this.state.offsetAY*=o,this.state.offsetBX*=o,this.state.offsetBY*=o,this.draw(),this.showMagnifier&&this.updateMagnifier(i,a)}handleWipeUIInteraction(a,s){const n=t(this.state);if("translation"===this.activeHandle)this.state.wipePositionInImageACoords=this.canvasToImageCoords(a,s,"A");else if("rotation"===this.activeHandle){const t=a-n.x,e=s-n.y;this.state.wipeAngle=Math.atan2(e,t)*(180/Math.PI)}else if("alpha"===this.activeHandle){const t=a-n.x,o=s-n.y,h=360-(Math.atan2(o,t)*(180/Math.PI)-this.state.wipeAngle+360)%360;h>=i&&h<=e?this.state.wipeAlpha=1-(h-i)/50:h<e||h>225?this.state.wipeAlpha=1:h>i&&(this.state.wipeAlpha=0)}this.draw()}updateImageInfo(t,e,i){const{isLoaded:a,image:s,imageData:n,coordsRgbaElement:o}=this.getImageElements(i);if(a&&s){const a=this.canvasToImageCoords(t,e,i),h=Math.floor(a.x),r=Math.floor(a.y);if(n&&a.x>=0&&a.x<s.width&&a.y>=0&&a.y<s.height){const t=4*(r*s.width+h),e=String(n.data[t]).padStart(3,"0"),i=String(n.data[t+1]).padStart(3,"0"),a=String(n.data[t+2]).padStart(3,"0"),l=String(n.data[t+3]).padStart(3,"0");o.textContent=` [${h},${r}]=(${e},${i},${a},${l})`}else o.textContent=` [${h},${r}]=(-,-,-,-)`}else o.textContent=""}updateMouseInfo(t,e){this.updateImageInfo(t,e,"A"),this.updateImageInfo(t,e,"B")}updateCursor(e,i,n){if(!this.state.canvas)return;if(this.showMagnifier)return;let o="move";if(this.state.isWipeEnabled&&this.state.imageALoaded&&this.state.imageBLoaded){const n=t(this.state);if(Math.sqrt(Math.pow(e-n.x,2)+Math.pow(i-n.y,2))<=6)o="grab";else if(!this.state.isSimpleWipe){const{x:t,y:h}=a(n,this.state.wipeAngle);if(Math.sqrt(Math.pow(e-t,2)+Math.pow(i-h,2))<=4)o="grab";else{const t=s(n,this.state.wipeAngle,this.state.wipeAlpha),a=t.x,h=t.y;Math.sqrt(Math.pow(e-a,2)+Math.pow(i-h,2))<=4&&(o="grab")}}}n&&this.state.isWipeEnabled&&this.state.imageALoaded&&this.state.imageBLoaded&&(o="grab"),this.state.canvas.style.cursor=o}updateMagnifier(e,i){this.showMagnifier&&(function(e,i,a,s,n){const r=n.magnifierRadius||200,g=n.magnifierZoomFactor||8,p=n.magnifierBorderSize||2;if(g<=0)return;e.style.left=a-r-p+"px",e.style.top=s-r-p+"px";const f=2*r;i.width===f&&i.height===f||(i.width=f,i.height=f);const m=i.getContext("2d");if(!m)return;m.fillStyle="black",m.fillRect(0,0,f,f),m.save(),m.beginPath(),m.arc(r,r,r,0,2*Math.PI),m.clip();const u=(a-n.offsetX)/n.scale,b=(s-n.offsetY)/n.scale,w=r-u*n.scale*g,A=r-b*n.scale*g;n.isCheckerboard&&o(m,f,f,a-r,s-r,n.checkerboardSquareSize||10);const v={canvas:i,ctx:m,imageA:n.imageA,imageB:n.imageB,imageAData:n.imageAData,imageBData:n.imageBData,imageAMipMaps:n.imageAMipMaps,imageBMipMaps:n.imageBMipMaps,imageALoaded:n.imageALoaded,imageBLoaded:n.imageBLoaded,scale:n.scale*g,offsetX:w,offsetY:A,offsetAX:n.offsetAX*g,offsetAY:n.offsetAY*g,offsetBX:n.offsetBX*g,offsetBY:n.offsetBY*g,wipePositionInImageACoords:n.wipePositionInImageACoords,wipeAngle:n.wipeAngle,wipeAlpha:n.wipeAlpha,isWipeEnabled:n.isWipeEnabled,isSimpleWipe:n.isSimpleWipe,isCheckerboard:n.isCheckerboard,compositeMode:n.compositeMode,showHelp:n.showHelp,magnifierRadius:n.magnifierRadius,magnifierZoomFactor:n.magnifierZoomFactor};if("A"===n.compositeMode)n.imageA&&n.imageALoaded&&d(v,"A");else if("B"===n.compositeMode)n.imageB&&n.imageBLoaded&&d(v,"B");else if(n.isWipeEnabled){const e=t(v);if(n.imageA&&n.imageALoaded&&d(v,"A"),m.save(),h(m,e,n.wipeAngle*Math.PI/180,0,0,v),m.clip(),n.imageA&&n.imageALoaded&&n.imageB&&n.imageBLoaded){const t=n.isSimpleWipe?1:n.wipeAlpha;l({...v,wipeAlpha:t},t)}m.restore(),c(m,e,n.wipeAngle*Math.PI/180)}else n.imageA&&n.imageALoaded&&n.imageB&&n.imageBLoaded&&l(v,n.wipeAlpha);m.restore(),m.strokeStyle="rgba(255, 255, 255, 0.8)",m.lineWidth=1,m.beginPath(),m.moveTo(0,r),m.lineTo(f,r),m.stroke(),m.beginPath(),m.moveTo(r,0),m.lineTo(r,f),m.stroke()}(this.magnifierContainer,this.magnifierCanvas,e,i,this.state),this.magnifierContainer.classList.remove("hidden"))}handleDragOver(t){if(t.preventDefault(),t.dataTransfer?.types.includes("Files")){const e=t.dataTransfer.files?.length||t.dataTransfer.items?.length||1;this.dragMessage.textContent=e>2?"Drop only up to 2 images":1===e?"Drop to load as image A":"Drop to load as images A and B",this.dragMessage.style.opacity="1"}}handleDragLeave(t){this.contains(t.relatedTarget)||(this.dragMessage.style.opacity="0")}handleUploadBoxDragOver(t,e){if(e.preventDefault(),e.stopPropagation(),e.dataTransfer?.types.includes("Files")){if(this.state.imageALoaded&&this.state.imageBLoaded)return;("A"===t?this.uploadA:this.uploadB).style.backgroundColor="#888",this.dragMessage.textContent=`Drop to load as image ${t}`,this.dragMessage.style.opacity="1"}}handleUploadBoxDragLeave(t,e){e.preventDefault(),e.stopPropagation(),("A"===t?this.uploadA:this.uploadB).style.backgroundColor=""}handleUploadBoxDrop(t,e){if(e.preventDefault(),e.stopPropagation(),this.dragMessage.style.opacity="0",("A"===t?this.uploadA:this.uploadB).style.backgroundColor="",e.dataTransfer?.files&&e.dataTransfer.files.length>0){const i=e.dataTransfer.files[0],a=URL.createObjectURL(i);this.loadImage(a,t,i.name)}}handleDrop(t){if(t.preventDefault(),this.dragMessage.style.opacity="0",t.dataTransfer?.files&&t.dataTransfer.files.length>0){if(t.dataTransfer.files.length>2)return;if(2===t.dataTransfer.files.length&&(this.dragMessage.textContent="Loading images...",this.dragMessage.style.opacity="1"),t.dataTransfer.files.length>=1){const e=t.dataTransfer.files[0],i=URL.createObjectURL(e);this.loadImage(i,"A",e.name)}if(t.dataTransfer.files.length>=2){const e=t.dataTransfer.files[1],i=URL.createObjectURL(e);this.loadImage(i,"B",e.name)}}}handleKeyDown(t){switch(t.preventDefault(),t.key.toLowerCase()){case"v":this.state.isSimpleWipe?this.centerWipePosition():this.setWipeMode(!0);break;case"w":!this.state.isSimpleWipe&&this.state.isWipeEnabled?this.centerWipePosition():this.setWipeMode(!1);break;case"a":this.setDisplayMode("A");break;case"b":this.setDisplayMode("B");break;case"u":this.setDisplayMode("Under");break;case"o":this.setDisplayMode("OnionSkin");break;case"d":this.setDisplayMode("Diff");break;case"i":this.setDisplayMode("InvDiff");break;case"c":this.state.isCheckerboard=!this.state.isCheckerboard,this.draw();break;case"r":this.resetView();break;case"h":case"?":this.state.showHelp=!this.state.showHelp,this.manuallyToggledHelp=!0,this.updateHelpScreenVisibility();break;case"control":if(this.state.magnifierZoomFactor&&this.state.magnifierZoomFactor>0)if(this.showMagnifier=!0,this.magnifierContainer.classList.remove("hidden"),this.state.canvas.style.cursor="none",0!==this.lastMouseX&&0!==this.lastMouseY)this.updateMagnifier(this.lastMouseX,this.lastMouseY);else if(this.state.canvas){const t=this.state.canvas.width/2,e=this.state.canvas.height/2;this.updateMagnifier(t,e)}}}handleKeyUp(t){"Shift"===t.key?this.updateCursor(this.lastMouseX,this.lastMouseY,!1):"control"===t.key.toLowerCase()&&(this.showMagnifier=!1,this.magnifierContainer.classList.add("hidden"),this.updateCursor(this.lastMouseX,this.lastMouseY,!1))}extractFilename(t){if(t.startsWith("blob:"))return"Uploaded file";const e=t.split("/");return e[e.length-1].split("?")[0]||"Unknown file"}resetView(){if(this.state.imageALoaded||this.state.imageBLoaded){if(this.state.scale=1,this.state.offsetX=0,this.state.offsetY=0,this.state.offsetAX=0,this.state.offsetAY=0,this.state.offsetBX=0,this.state.offsetBY=0,this.state.wipeAngle=0,this.state.wipeAlpha=1,this.state.isSimpleWipe=!1,this.setAttribute("wipe-angle","0"),this.setAttribute("wipe-alpha","1"),this.setAttribute("wipe-mode","full"),this.state.imageALoaded&&this.state.imageA&&this.state.canvas){const t=this.state.imageA.width,e=this.state.imageA.height;this.state.scale=.9*Math.min(this.state.canvas.width/t,this.state.canvas.height/e),this.state.offsetX=(this.state.canvas.width-t*this.state.scale)/2,this.state.offsetY=(this.state.canvas.height-e*this.state.scale)/2}else if(this.state.imageBLoaded&&this.state.imageB&&this.state.canvas){const t=this.state.imageB.width,e=this.state.imageB.height;this.state.scale=.9*Math.min(this.state.canvas.width/t,this.state.canvas.height/e),this.state.offsetX=(this.state.canvas.width-t*this.state.scale)/2,this.state.offsetY=(this.state.canvas.height-e*this.state.scale)/2}this.state.imageALoaded&&this.state.canvas&&this.centerWipePosition(),this.draw(),this.updatePSNR()}}handleFileInput(t,e){const i=t.target;if(i.files&&i.files[0]){const t=i.files[0],a=URL.createObjectURL(t);this.loadImage(a,e,t.name)}}handleFileInputA(t){this.handleFileInput(t,"A")}handleFileInputB(t){this.handleFileInput(t,"B")}canvasToImageCoords(t,e,i){return function(t,e,i="A",a){const s="A"===i?a.offsetAX:a.offsetBX,n="A"===i?a.offsetAY:a.offsetBY;return{x:(t-a.offsetX-s)/a.scale,y:(e-a.offsetY-n)/a.scale}}(t,e,i,this.state)}draw(){this.state.ctx&&this.state.canvas&&function(n,r=!0){if(n.ctx&&n.canvas){if(n.ctx.fillStyle="black",n.ctx.fillRect(0,0,n.canvas.width,n.canvas.height),n.isCheckerboard){const t=n.checkerboardSquareSize||10;o(n.ctx,n.canvas.width,n.canvas.height,0,0,t)}(n.imageALoaded||n.imageBLoaded)&&(n.isWipeEnabled&&n.imageALoaded&&n.imageBLoaded?function(n,o=!0){if(!(n.ctx&&n.canvas&&n.imageALoaded&&n.imageBLoaded))return;const r=n.canvas.width,g=n.canvas.height,p=t(n),f=n.isSimpleWipe?0:n.wipeAngle*(Math.PI/180);d(n,"A"),n.ctx.save(),h(n.ctx,p,f,0,0,n),n.ctx.clip();const m=document.createElement("canvas");m.width=r,m.height=g;const u=m.getContext("2d");if(u){const t=n.isSimpleWipe?1:n.wipeAlpha;l({...n,ctx:u,canvas:m},t),n.ctx.globalAlpha=1,n.ctx.drawImage(m,0,0)}n.ctx.restore(),o&&(c(n.ctx,p,n.wipeAngle),function(t,n,o,h){if(t.save(),t.strokeStyle="white",t.lineWidth=1,t.shadowColor="black",t.shadowBlur=2,t.fillStyle="white",t.beginPath(),t.arc(n.x,n.y,6,0,2*Math.PI),t.fill(),t.stroke(),!h.isSimpleWipe){const r=a(n,o);t.beginPath(),t.moveTo(n.x,n.y),t.lineTo(r.x,r.y),t.stroke(),t.beginPath(),t.arc(r.x,r.y,4,0,2*Math.PI),t.fill(),t.stroke();const l=o*(Math.PI/180),d=l-e*Math.PI/180,c=l-i*Math.PI/180;t.beginPath(),t.arc(n.x,n.y,40,d,c),t.stroke();const g=s(n,o,h.wipeAlpha);t.beginPath(),t.arc(g.x,g.y,4,0,2*Math.PI),t.fill(),t.stroke()}t.restore()}(n.ctx,p,n.wipeAngle,n))}(n,r):function(t){if(t.ctx&&t.canvas)switch(t.compositeMode){case"A":t.imageALoaded&&t.imageA&&d(t,"A");break;case"B":t.imageBLoaded&&t.imageB&&d(t,"B");break;case"Under":t.imageALoaded&&t.imageA&&d(t,"A"),t.imageBLoaded&&t.imageB&&(t.imageALoaded&&t.imageA&&(t.ctx.globalAlpha=t.wipeAlpha),d(t,"B"),t.ctx.globalAlpha=1);break;case"OnionSkin":if(t.imageALoaded&&t.imageA&&d(t,"A"),t.imageBLoaded&&t.imageB){if(t.imageALoaded&&t.imageA){t.ctx.globalAlpha=t.wipeAlpha;const e=t.ctx.globalCompositeOperation;t.ctx.globalCompositeOperation="lighter",d(t,"B"),t.ctx.globalCompositeOperation=e}else d(t,"B");t.ctx.globalAlpha=1}break;case"Diff":case"InvDiff":t.imageALoaded&&t.imageBLoaded&&t.imageA&&t.imageB&&g(t,"InvDiff"===t.compositeMode,1)}}(n))}}(this.state)}}customElements.define("image-comparison",p)})();